{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ae27e7ec_82431cf7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 17,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-31T10:35:03Z",
      "side": 1,
      "message": "Citation needed.",
      "range": {
        "startLine": 17,
        "startChar": 57,
        "endLine": 17,
        "endChar": 71
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "49866efb_6558dfcd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 17,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-07-31T19:58:51Z",
      "side": 1,
      "message": "I added more comments in the code. Let me know if it\u0027s unclear.",
      "parentUuid": "ae27e7ec_82431cf7",
      "range": {
        "startLine": 17,
        "startChar": 57,
        "endLine": 17,
        "endChar": 71
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9a40ed6a_ed001a0c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-07-28T22:42:09Z",
      "side": 1,
      "message": "PTAL",
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e1f531c5_c9795c26",
        "filename": "cmds/installd/InstalldNativeService.cpp",
        "patchSetId": 2
      },
      "lineNbr": 3883,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-31T10:35:03Z",
      "side": 1,
      "message": "That feels like a slightly weak check.\nPassing an fd is a good way to make sure an app can actually access a file it wants us to work on.\nBut elsewhere we\u0027ve relied on paths, provided to us by system server (so already reasonably trusted) and which we validate to make sure they aren\u0027t suspicious and match app data file paths.\nI\u0027m not entirely sure which if either would be better here.\nOf course if you do it by path you have to do it installd; if you do it by fd you can do it in system server.\n\nI suppose you could fetch the path and/or selinux label from the fd and sanitise that, as an additional check?",
      "range": {
        "startLine": 3877,
        "startChar": 0,
        "endLine": 3883,
        "endChar": 0
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5bbdc317_d6b13fbd",
        "filename": "cmds/installd/InstalldNativeService.cpp",
        "patchSetId": 2
      },
      "lineNbr": 3883,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-07-31T19:58:51Z",
      "side": 1,
      "message": "Added the context check. I at first tried to parse the label, but it got complicated quickly.  I end up with simple prefix matching.\n\nI\u0027m not sure how passing the path helps though.  In either case, system server (system uid) does not have permission to manupilate app\u0027s file, so it still has to be done in installd as root.",
      "parentUuid": "e1f531c5_c9795c26",
      "range": {
        "startLine": 3877,
        "startChar": 0,
        "endLine": 3883,
        "endChar": 0
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fcb0a4d0_37ef1a6e",
        "filename": "cmds/installd/InstalldNativeService.cpp",
        "patchSetId": 2
      },
      "lineNbr": 3883,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-08-01T13:26:10Z",
      "side": 1,
      "message": "https://source.corp.google.com/h/googleplex-android/platform/superproject/main/+/main:packages/modules/Virtualization/virtualizationmanager/src/selinux.rs;drc\u003d3f0f1e80df7369c7dac42d3fcdf65e688a26431d;l\u003d90\n\nBut I don\u0027t really like this sort of selinux label munging, it\u0027s a last resort.",
      "parentUuid": "5bbdc317_d6b13fbd",
      "range": {
        "startLine": 3877,
        "startChar": 0,
        "endLine": 3883,
        "endChar": 0
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c6c7f2ce_2e3c49a1",
        "filename": "cmds/installd/InstalldNativeService.h",
        "patchSetId": 2
      },
      "lineNbr": 39,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-31T10:35:03Z",
      "side": 1,
      "message": "I thought forward declarations in headers were discouraged?",
      "range": {
        "startLine": 37,
        "startChar": 0,
        "endLine": 39,
        "endChar": 17
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fcb60879_eae313ac",
        "filename": "cmds/installd/InstalldNativeService.h",
        "patchSetId": 2
      },
      "lineNbr": 39,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-07-31T19:58:51Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c6c7f2ce_2e3c49a1",
      "range": {
        "startLine": 37,
        "startChar": 0,
        "endLine": 39,
        "endChar": 17
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e8f0d434_35df4508",
        "filename": "cmds/installd/binder/android/os/IInstalld.aidl",
        "patchSetId": 2
      },
      "lineNbr": 137,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2023-07-31T10:35:03Z",
      "side": 1,
      "message": "Wait, what is this? Binder already gives you an unspoofable calling UID.\nAnd if it\u0027s being passed to you, why should you trust it?\n\nIf we trust system server to call this, why not have system server do the ioctl?",
      "range": {
        "startLine": 137,
        "startChar": 27,
        "endLine": 137,
        "endChar": 37
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "80fd905a_1bc4eb60",
        "filename": "cmds/installd/binder/android/os/IInstalld.aidl",
        "patchSetId": 2
      },
      "lineNbr": 137,
      "author": {
        "id": 1042276
      },
      "writtenOn": "2023-07-31T19:58:51Z",
      "side": 1,
      "message": "Renamed to reduce confusion.  This is the app UID, i.e. who calls system server, which forwards to installd.",
      "parentUuid": "e8f0d434_35df4508",
      "range": {
        "startLine": 137,
        "startChar": 27,
        "endLine": 137,
        "endChar": 37
      },
      "revId": "f066a10780ca34457056addccacf038076f52e67",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}