{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a90bfc56_851a9f01",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-02T06:30:37Z",
      "side": 1,
      "message": "Hi, Google team, why don\u0027t we use the 2 * offset when creating the second surface? Because the first blur has used 1 * offset. Please help CR the change, thanks!",
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "03ec1aaf_b227b1d2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1012974
      },
      "writtenOn": "2024-04-02T20:11:16Z",
      "side": 1,
      "message": "Added a new comment inline with the code, which I think makes this more clear. Let\u0027s follow along there.",
      "parentUuid": "a90bfc56_851a9f01",
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "884d4874_6be24cee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-03T02:20:32Z",
      "side": 1,
      "message": "Yes, after applying this patch, I found that the blurring effect is better than before. I\u0027m not sure whether this is a custom adjustment based on Kawase algorithm on the engineering side. I can\u0027t see either of the two patches in the comments here. Could you please help me check it? Thanks!",
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "294a3f0e_b1012e34",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-03T02:28:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "884d4874_6be24cee",
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "90854dd7_03523048",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1012974
      },
      "writtenOn": "2024-04-03T16:39:40Z",
      "side": 1,
      "message": "@rgl@google.com, is this change okay with you? From a code perspective, it\u0027s fine, but it does slightly change the behavior. [This comment](https://android-review.git.corp.google.com/c/platform/frameworks/native/+/3019150/comment/23f7c83e_96187e05/) has more details.",
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f39d2cdc_82e2c1dd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1045544
      },
      "writtenOn": "2024-04-04T14:10:20Z",
      "side": 1,
      "message": "Revived aosp/3027683 to help check if this gets closer than the current behaviour.",
      "parentUuid": "90854dd7_03523048",
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "23f7c83e_96187e05",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1012974
      },
      "writtenOn": "2024-04-02T20:11:16Z",
      "side": 1,
      "message": "From [this comment](https://android-review.git.corp.google.com/c/platform/frameworks/native/+/3019150/comments/a90bfc56_851a9f01) - we already used `radiusByPasses * kInputScale` for `in_blurOffset` on line 109, so why do we start with `i \u003d\u003d 1`, effectively using the same value again?\n\nUnless I\u0027m missing something, we\u0027ve roughly used this behavior since this code was introduced in I459780d9fd408865d1d9713f37bf308f07c4fdfc, though the code has changed quite a bit since then. It *may* be that this was the behavior in `GLESRenderEngine`, though I haven\u0027t checked. ( @alecmouri@google.com, perhaps you remember?)\n\nI\u0027m not familiar with this algorithm, so I don\u0027t know whether starting with `i` of `2` is more correct (though it seems believable), but I think it would at least change the way the blur looks. @linkai@xiaomi.com, do you notice a difference in appearance or performance?\n\n@johnstiles@google.com, I think you advised me on the \"ping pong\" approach here, introduced in I7ad2438a0e5d9e437b0256eb302fe2fd44e9c093. Does this CL look right?",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8657a3fa_2b71b73e",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-03T02:20:32Z",
      "side": 1,
      "message": "@scroggo@google.com,",
      "parentUuid": "23f7c83e_96187e05",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f04dc225_bf6487d5",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-03T02:24:55Z",
      "side": 1,
      "message": "\u003e @scroggo@google.com, thank you for your reply.",
      "parentUuid": "8657a3fa_2b71b73e",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d365cd1c_d085abab",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-03T02:30:30Z",
      "side": 1,
      "message": "@scroggo@google.com, thank you for your reply.\nYes, after applying this patch, I found that the blurring effect is better than before. I\u0027m not sure whether this is a custom adjustment based on Kawase algorithm on the engineering side. I can\u0027t see either of the two patches in the comments here. Could you please help me check it? Thanks!",
      "parentUuid": "f04dc225_bf6487d5",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ddd38a3_ef1632cc",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1684929
      },
      "writtenOn": "2024-04-03T13:38:50Z",
      "side": 1,
      "message": "FYI--the git hashes you\u0027re sending do not work for me.\n\nI checked in codesearch and I don\u0027t think the CL I reviewed would have changed behavior. However, it\u0027s possible that this was always wrong. https://screenshot.googleplex.com/6ggZKKUe3wEGzUA",
      "parentUuid": "23f7c83e_96187e05",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6dacf668_55caabcc",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1684929
      },
      "writtenOn": "2024-04-03T13:41:27Z",
      "side": 1,
      "message": "This change seems correct to me. Existing blurs will look different, though. Is this public API?",
      "parentUuid": "1ddd38a3_ef1632cc",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9dded0c7_a6237b3d",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1012974
      },
      "writtenOn": "2024-04-03T16:39:40Z",
      "side": 1,
      "message": "\u003e I can\u0027t see either of the two patches in the comments here. Could you please help me check it?\n\n\u003e FYI--the git hashes you\u0027re sending do not work for me.\n\nSorry for the confusion - these are `Change-Id`s, not git hashes. Annoyingly, they don\u0027t show here because they were made in internal Android Gerrit. Internal users (e.g. John) can find them by putting them into ag/. Here they are from gitiles:\n- https://android.googlesource.com/platform/frameworks/native/+/f4cb4a001eb33c6ceedce46b52fb29453dda3a4b\n- https://android.googlesource.com/platform/frameworks/native/+/dfc8febc3ac84a59b456428e026516376915ed36\n\n\u003e I checked in codesearch and I don\u0027t think the CL I reviewed would have changed behavior. However, it\u0027s possible that this was always wrong.\n\nAgreed on both points.\n\n\u003e This change seems correct to me.\n\nThanks for the confirmation!\n\n\u003e Existing blurs will look different, though. Is this public API?\n\nNo, not public API. This is only used by `RenderEngine`, not apps.\n\nI\u0027ve tested before and after the change and uploaded videos. Not sure if they\u0027ll be viewable externally, but they are:\n- [blur_old.mp4](http://screencast/cast/NDcwNzI4NjIyMzE1OTI5Nnw3MzQwMDMzYS1mMA)\n- [blur_new.mp4](http://screencast/cast/NjI3NjgwNjcyNTMzNzA4OHxjNTE3YWM3MS0yNg)\n\nI don\u0027t notice a significant difference. I was tempted to say the \"new\" one (i.e. with this change) looks \"blurrier\" for some frames, which is I think what you\u0027d expect. But it\u0027s hard to line up the two videos perfectly; we use a larger blur anyway the further you pull down the shade.\n\nI think we should get approval from someone on SysUI, since we\u0027re changing behavior, but this looks like a fine change to me.",
      "parentUuid": "6dacf668_55caabcc",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f79c503b_7db24d71",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1684929
      },
      "writtenOn": "2024-04-03T17:35:12Z",
      "side": 1,
      "message": "I managed to stop both videos at roughly the same point in the transition (assuming the vertical position of the \"home-screen\" as it is pulled down corresponds directly to amount of blurriness applied) and can confirm that the new side gets slightly blurrier at the same point.",
      "parentUuid": "9dded0c7_a6237b3d",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19f6d8ee_b9f52176",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1470474
      },
      "writtenOn": "2024-04-03T18:26:09Z",
      "side": 1,
      "message": "\u003e It may be that this was the behavior in GLESRenderEngine, though I haven\u0027t checked. \n\nThe patch that added this to GLESREnderEngine (patch I462de2642c0400dd31d1808fdfcf522c319fa839) did so as part of a broader performance optimization. This was probably just missed.\n\nI do want to clarify that this _is_ public api: https://developer.android.com/reference/android/view/WindowManager.LayoutParams#setBlurBehindRadius(int); however, as long as we\u0027re still respecting the same blur radius (although at first glance, this does _increase_ the radius used) it\u0027ll probably be okay from an app-compat standpoint, since we\u0027re allowed to change implementation details to fix bugs. Of course, we can still check with sysui.",
      "parentUuid": "f79c503b_7db24d71",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6fce1bbc_07aa028f",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1045544
      },
      "writtenOn": "2024-04-04T14:10:20Z",
      "side": 1,
      "message": "It\u0027s not only public API with an abstract \"radius\", we ought to make sure that the radius parameter works roughly the same as View-level `RenderEffect.createBlurEffect` even if they\u0027re using different algorithms at the moment.\n\nWhen we\u0027re talking about \"better\" / \"more blurry\", have you checked if this is making the blur effect closer to GaussianBlur or less like it?",
      "parentUuid": "19f6d8ee_b9f52176",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "12e002d8_aa94eeb8",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1012974
      },
      "writtenOn": "2024-04-04T14:55:29Z",
      "side": 1,
      "message": "Good point, and thanks for the other CL! @njawad@google.com",
      "parentUuid": "6fce1bbc_07aa028f",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "216f192e_708006d8",
        "filename": "libs/renderengine/skia/filters/KawaseBlurFilter.cpp",
        "patchSetId": 1
      },
      "lineNbr": 133,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-05T08:00:28Z",
      "side": 1,
      "message": "Hi，Google team, I created an issue tracking(b/333002945) on this patch and verified it through the SSIM algorithm in the image field. The fixed effect is closer to Gaussian blur. Could you help me check this verification? Thanks!",
      "parentUuid": "12e002d8_aa94eeb8",
      "range": {
        "startLine": 133,
        "startChar": 59,
        "endLine": 133,
        "endChar": 91
      },
      "revId": "d3f8310f93cd97ea0c948fea2b8b28bc28a430d1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}