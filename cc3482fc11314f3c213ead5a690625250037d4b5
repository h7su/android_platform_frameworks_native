{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b78d6280_a1e3eaf3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "Thank you for the change. I will continue reviewing this CL later once the comments about RestorableFile are addressed.",
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fb34e958_a692fe0d",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1108,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "Nit: Add a space before the path.",
      "range": {
        "startLine": 1108,
        "startChar": 40,
        "endLine": 1108,
        "endChar": 41
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5434a6d2_9d4efca8",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1108,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-04T01:17:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fb34e958_a692fe0d",
      "range": {
        "startLine": 1108,
        "startChar": 40,
        "endLine": 1108,
        "endChar": 41
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93a2e6fd_016bf71d",
        "filename": "cmds/installd/restorable_file.cpp",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "I think all these can be done by UniqueFile. You don\u0027t have to do them yourself. For example, the file can be automatically closed by UniqueFile if you don\u0027t do `DisableAutoClose()` in the constructor, and `UnlinkPossiblyNonExistingFile` can be done as the CleanUpFunction.",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 88,
        "endChar": 1
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c88dea63_cb08baef",
        "filename": "cmds/installd/restorable_file.cpp",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-04T01:17:22Z",
      "side": 1,
      "message": "Commit() requires closing tmp file and rename it while destructor requires tmp file to be closed and deleted. So exiting reset() cannot handle this behavior for two cases. I will use reset for closing part while other part should be done here.",
      "parentUuid": "93a2e6fd_016bf71d",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 88,
        "endChar": 1
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "77c3a4d0_3495eec7",
        "filename": "cmds/installd/restorable_file.cpp",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-06T12:20:48Z",
      "side": 1,
      "message": "I believe removing the file automatically is exactly what the CleanUpFunction in UniqueFile is used for. It covers the case where you don\u0027t want to keep the file.\n\nTo cover the other case, you can call `unique_file_.DisableCleanup()` in CommitWorkFile() before you call `unique_file_.reset()`, so that the file will be kept.\n\nWill this work?",
      "parentUuid": "c88dea63_cb08baef",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 88,
        "endChar": 1
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a94ab6fd_f9b0eaad",
        "filename": "cmds/installd/restorable_file.cpp",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-06T20:24:51Z",
      "side": 1,
      "message": "Yes but it requires too deep interaction with UniqueFile. I would rather rely on UniqueFile only for closing / managing files.",
      "parentUuid": "77c3a4d0_3495eec7",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 88,
        "endChar": 1
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31a9f112_bcde34ab",
        "filename": "cmds/installd/restorable_file.cpp",
        "patchSetId": 4
      },
      "lineNbr": 88,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-06T20:30:32Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a94ab6fd_f9b0eaad",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 88,
        "endChar": 1
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2afb0e5e_63374aa1",
        "filename": "cmds/installd/restorable_file.cpp",
        "patchSetId": 4
      },
      "lineNbr": 91,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "I believe this can be done by `unique_file_.DisableCleanup()` and then `unique_file_.reset()`. Do you really need your own implementation?",
      "range": {
        "startLine": 91,
        "startChar": 4,
        "endLine": 91,
        "endChar": 20
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ac19f62f_1cc36f41",
        "filename": "cmds/installd/restorable_file.cpp",
        "patchSetId": 4
      },
      "lineNbr": 91,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-04T01:17:22Z",
      "side": 1,
      "message": "explained above.",
      "parentUuid": "2afb0e5e_63374aa1",
      "range": {
        "startLine": 91,
        "startChar": 4,
        "endLine": 91,
        "endChar": 20
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7395cfb0_b654a162",
        "filename": "cmds/installd/restorable_file.h",
        "patchSetId": 4
      },
      "lineNbr": 40,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "Does this constructor initializes the class in an invalid state? If so, please add some comments.",
      "range": {
        "startLine": 40,
        "startChar": 4,
        "endLine": 40,
        "endChar": 21
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7bfe8933_d57bba13",
        "filename": "cmds/installd/restorable_file.h",
        "patchSetId": 4
      },
      "lineNbr": 40,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-04T01:17:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7395cfb0_b654a162",
      "range": {
        "startLine": 40,
        "startChar": 4,
        "endLine": 40,
        "endChar": 21
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1f577ed_60aaa06f",
        "filename": "cmds/installd/restorable_file.h",
        "patchSetId": 4
      },
      "lineNbr": 41,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "Does \"\u003d default\" work?",
      "range": {
        "startLine": 41,
        "startChar": 4,
        "endLine": 41,
        "endChar": 43
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "67792371_2f0dc884",
        "filename": "cmds/installd/restorable_file.h",
        "patchSetId": 4
      },
      "lineNbr": 41,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-04T01:17:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c1f577ed_60aaa06f",
      "range": {
        "startLine": 41,
        "startChar": 4,
        "endLine": 41,
        "endChar": 43
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "83329a84_f4e2355c",
        "filename": "cmds/installd/restorable_file.h",
        "patchSetId": 4
      },
      "lineNbr": 47,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "Ditto.",
      "range": {
        "startLine": 47,
        "startChar": 4,
        "endLine": 47,
        "endChar": 54
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "636e6629_0b125e76",
        "filename": "cmds/installd/restorable_file.h",
        "patchSetId": 4
      },
      "lineNbr": 47,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-04T01:17:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "83329a84_f4e2355c",
      "range": {
        "startLine": 47,
        "startChar": 4,
        "endLine": 47,
        "endChar": 54
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6ca9a79f_cae4b387",
        "filename": "cmds/installd/restorable_file.h",
        "patchSetId": 4
      },
      "lineNbr": 62,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "Maybe I\u0027m missing something. IIUC, the whole point of this `RestorableFile` class is keep the original file unchanged unless a new version is committed. If that\u0027s true, why do we ever want to remove the original file? I think this class should never remove the original file. If a user don\u0027t want the original file, they can use `UniqueFile` instead of this class.",
      "range": {
        "startLine": 61,
        "startChar": 0,
        "endLine": 62,
        "endChar": 60
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aca5b83f_3b3e7f62",
        "filename": "cmds/installd/restorable_file.h",
        "patchSetId": 4
      },
      "lineNbr": 62,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-04T01:17:22Z",
      "side": 1,
      "message": "Yes, in my use case, I don\u0027t need cleanup. So this can be removed. I thought that it may be better to keep the API consistent with UniqueFile but it can be removed for now.",
      "parentUuid": "6ca9a79f_cae4b387",
      "range": {
        "startLine": 61,
        "startChar": 0,
        "endLine": 62,
        "endChar": 60
      },
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bff786ff_c4ca862a",
        "filename": "cmds/installd/tests/installd_file_test.cpp",
        "patchSetId": 4
      },
      "lineNbr": 188,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-12-03T12:12:48Z",
      "side": 1,
      "message": "Isn\u0027t the original supposed to be kept?",
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ad49f05b_ad19a1b1",
        "filename": "cmds/installd/tests/installd_file_test.cpp",
        "patchSetId": 4
      },
      "lineNbr": 188,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-12-04T01:17:22Z",
      "side": 1,
      "message": "This is the case where cleanup is enabled by default. So original file is also removed. We can remove this test case if we always keep the original file for ResotableFile.",
      "parentUuid": "bff786ff_c4ca862a",
      "revId": "cc3482fc11314f3c213ead5a690625250037d4b5",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}