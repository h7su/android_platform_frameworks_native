{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "26b341ab_993c9a74",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-09T11:57:27Z",
      "side": 1,
      "message": "Hi, Google team, I have modified the atest case. Due to the increase in the blur radius, the previous case for solid color seems to be no longer useful. I see that there isn\u0027t solid color case in the following path: frameworks/av/media/libstagefright/renderfright/tests/RenderEngineTest.cpp. So do you suggest deleting it or increasing the tolerance? Thanks!",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d5c74a6d_53c334d2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1684929
      },
      "writtenOn": "2024-04-09T13:57:29Z",
      "side": 1,
      "message": "Blurring a solid color should result in the solid color again. If that\u0027s not working, maybe there is a real bug?",
      "parentUuid": "26b341ab_993c9a74",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d9995679_cfcae703",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1470474
      },
      "writtenOn": "2024-04-09T20:48:03Z",
      "side": 1,
      "message": "it sounds like the applied radius may be too large, if the corner of the red layer is picking up green values after blurring (the red layer is 64 pixels wide, while the blur radius is 50, so the corner opposite the green layer should _not_ be blurred).\n\nI don\u0027t recommend deleting this test case. It\u0027s intended to catch situations like where we change the effect in an unexpected way.",
      "parentUuid": "d5c74a6d_53c334d2",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "122c216f_1b66eaf4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-10T02:51:41Z",
      "side": 1,
      "message": "OK, Iâ€˜ll keep this case and modify the blur radius for the change in drawing. Thanks! cc @dupin@google.com",
      "parentUuid": "d9995679_cfcae703",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "58721905_8e54ad53",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-10T07:35:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "122c216f_1b66eaf4",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b55a61e_78fd3c98",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1470474
      },
      "writtenOn": "2024-04-11T16:30:15Z",
      "side": 1,
      "message": "It\u0027s still not clear to me if this is desired.\n\nWalking through the math I think this test is failing because a blur radius of 50 touches pixels that are up to 72 pixels away.\n\nThe way that I got there is:\n\n* We start with a blur radius of 50, then transform it to 25\n* We\u0027re using 4 passes, and we downscale by 4x in each dimension. So radiusByPasses is 1.5625.\n* Then we look at the color contribution of one pixel, P, to neighboring pixels in the downscaled buffers.\n  * First pass: ceil(1.5625) \u003d 2 pixels away from P are affected\n  * Second pass: ceil(1.5625 * 2) \u003d 4 pixels away from any pixels touched by the first pass are affected. This means that 6 pixels away from P are affected\n  * Third pass. Similarly, ceil(1.5625 * 3) + 6 \u003d 11 pixels away from P are affected\n  * Fourth pass. ceil(1.5625 * 4) + 11 \u003d 18 pixels away from P are affected.\n* Then we scale the final buffer back up, which gets us an effective radius of 72.\n\nWith the original implementation, we essentially replace the last pass with another copy of the first pass, which gives us a final effective radius of 52.\n\nThis is a fairly large difference.",
      "parentUuid": "58721905_8e54ad53",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae87f991_207cfdc3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-12T13:09:04Z",
      "side": 1,
      "message": "I verified the atest case by assuming that the blur radius is X, then the allowed blur radius by the modified algorithm is as follows:\nfloor(X / (2 * 4 * 4) + 0.5) * (1 + 2 + 3 + 4) \u003c 128 / 4 / 2\n\u003d\u003efloor(X / (2 * 4 * 4) + 0.5) \u003c 1.6\n\u003d\u003eX / (2 * 4 * 4) + 0.5 \u003c 2\n\u003d\u003eX \u003c 48\nSo X\u003d30 is safety.\n\nFirstly, the blur radius is transformed by 0.5x, and then radiusByPasses are obtained through downsampling and passes by 0.25x of twice. Then we add 0.5 to radiusByPasses and round them down. After 1x, 2x, 3x and 4x iterations, the influence range of the solid color pixel(0,0) should be constrained to 0.5x of the 0.25x down-sampling width.\nSo I think using 30 as the blur radius should be possible.",
      "parentUuid": "0b55a61e_78fd3c98",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05c00e87_8bdbe920",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1470474
      },
      "writtenOn": "2024-04-15T22:06:34Z",
      "side": 1,
      "message": "I\u0027m not doubting that a radius of 30 is safe for the test, specifically.\n\nI\u0027m concerned that since this is public api and that we\u0027ve effectively increased the blur radius by 50%, that we would need to do the following to upstream this:\n\n* Verify that this is in fact correct, or if there\u0027s a different change to the Kawase implementation that needs to be made to make it closer to a Gaussian without changing the effective radius.\n* Add target SDK checks and/or documentation to the various blur apis to say that the old Android versions will use a smaller radius than intended.\n* Talk to system ui teams so that they can reassess their user journeys involving blurs.",
      "parentUuid": "ae87f991_207cfdc3",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2a84fa4f_51cd23d0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1870086
      },
      "writtenOn": "2024-04-17T07:08:52Z",
      "side": 1,
      "message": "In order not to modify the existing Android version API, could we add system properties that support improved Kawase algorithm and update them during next Android version upgrades?",
      "parentUuid": "05c00e87_8bdbe920",
      "revId": "fa30f7dd018a748188fe7e557ff1c5753a0bc73f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}