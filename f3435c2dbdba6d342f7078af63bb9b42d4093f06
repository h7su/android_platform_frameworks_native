{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "cf8f9ec1_3bed6575",
        "filename": "libs/binder/Utils.h",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1944400
      },
      "writtenOn": "2023-10-17T23:23:42Z",
      "side": 1,
      "message": "putting this in a unique_ptr might make tools like address sanitizer unhappy and it isn\u0027t too bad to implement the \"right way\". as a bonus, it doesn\u0027t require the function to be small\n\n```\ntemplate \u003ctypename F\u003e\nstruct scope_guard {\n  F f;\n  ~scope_guard() { f(); }\n};\n\ntemplate \u003ctypename F\u003e\nscope_guard\u003cF\u003e make_scope_guard(F f) {\n  return scope_guard\u003cF\u003e { .f \u003d std::move(f) };\n}\n```",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 41
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f995dd48_45e1ad5c",
        "filename": "libs/binder/Utils.h",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-10-17T23:38:49Z",
      "side": 1,
      "message": "Did you mean to comment on https://r.android.com/2784072? I don\u0027t think I can use that scope_guard example in this CL.\n\nRegarding the suggested implementation, we would also need a flag to deactivate guard, delete some constructors and assignment operators and ideally implement move operator. Then, it suddenly makes more sense to copy-paste ScopeGuard from libbase:\nhttps://cs.android.com/android/platform/superproject/main/+/main:system/libbase/include/android-base/scopeguard.h\n\nIs making this based on unique_ptr really a problem? I don\u0027t think address sanitizer should be unhappy about this.\n\nAnyway, I\u0027m leaving it up to Steven to break a tie here.",
      "parentUuid": "cf8f9ec1_3bed6575",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 41
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e48e7ab_1db18c13",
        "filename": "libs/binder/Utils.h",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1944400
      },
      "writtenOn": "2023-10-17T23:49:10Z",
      "side": 1,
      "message": "\u003e Regarding the suggested implementation, we would also need a flag to deactivate guard\n\n```\ntemplate \u003ctypename F\u003e\nstruct scope_guard {\n  std::optional\u003cF\u003e f;\n  ~scope_guard() { if (f.has_value()) std::move(f.value())(); }\n  void release() { f.reset(); }\n};\n\ntemplate \u003ctypename F\u003e\nscope_guard\u003cF\u003e make_scope_guard(F f) {\n  return scope_guard\u003cF\u003e { .f \u003d std::make_optional(std::move(f)) };\n}\n```\n\n\u003e delete some constructors\n\nwhich constructors are problematic?\n\n\u003e assignment operators and ideally implement move operator\n\nimplicitly defined already\n\n\u003e Is making this based on unique_ptr really a problem? I don\u0027t think address sanitizer should be unhappy about this.\n\nnot sure, but a unique_ptr that points to memory it doesn\u0027t own seems unnecessarily messy to me\n\n\u003e Then, it suddenly makes more sense to copy-paste ScopeGuard from libbase:\n\nthat also sounds reasonable to me",
      "parentUuid": "f995dd48_45e1ad5c",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 41
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fe8e2ebf_af108fb7",
        "filename": "libs/binder/Utils.h",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1944400
      },
      "writtenOn": "2023-10-17T23:49:10Z",
      "side": 1,
      "message": "```\ntemplate \u003ctypename F\u003e\nstruct scope_guard {\n  F f;\n  ~scope_guard() { f(); }\n};\n\ntemplate \u003ctypename F\u003e\nscope_guard\u003cF\u003e make_scope_guard(F f) {\n  return scope_guard\u003cF\u003e { .f \u003d std::move(f) };\n}\n```",
      "parentUuid": "f995dd48_45e1ad5c",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 41
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc3e6589_5a0ffc38",
        "filename": "libs/binder/Utils.h",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-10-17T23:53:32Z",
      "side": 1,
      "message": "If we end up copying from libbase, I think we should make changes you suggested there (I like replacing flag with optional, or removing move constructor if it\u0027s not needed) - before making a copy.",
      "parentUuid": "fe8e2ebf_af108fb7",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 41
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e9a2a1e2_ebbe796c",
        "filename": "libs/binder/Utils.h",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-10-17T23:54:45Z",
      "side": 1,
      "message": "Ah, I missed this one:\n\u003e not sure, but a unique_ptr that points to memory it doesn\u0027t own seems unnecessarily messy to me\n\nIt doesn\u0027t point to any memory. It\u0027s just a pointer to either 0x0 or 0x1.",
      "parentUuid": "bc3e6589_5a0ffc38",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 41
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2e783cb4_066a6cc7",
        "filename": "libs/binder/Utils.h",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1944400
      },
      "writtenOn": "2023-10-18T00:58:36Z",
      "side": 1,
      "message": "It is a pointer to the memory at address 0x1, right?\n\nI don\u0027t feel that strongly about it just throwing my opinion out there. Whatever you two decide SGTM",
      "parentUuid": "e9a2a1e2_ebbe796c",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 41
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "557d1164_fbd353df",
        "filename": "libs/binder/Utils.h",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-10-18T16:42:19Z",
      "side": 1,
      "message": "If you don\u0027t feel strongly and Steven don\u0027t care too much, let\u0027s leave this as it is now? :) If this becomes a problem for some reason, we can always replace it with copy-paste from libutils (ideally improving it first with your comments).\n\nEither way, I\u0027m closing this thread here since it\u0027s not applicable for this change anyway.",
      "parentUuid": "2e783cb4_066a6cc7",
      "range": {
        "startLine": 97,
        "startChar": 12,
        "endLine": 97,
        "endChar": 41
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "162d6ffe_7696253c",
        "filename": "libs/binder/include/binder/RpcTransport.h",
        "patchSetId": 8
      },
      "lineNbr": 88,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-10-18T00:05:24Z",
      "side": 1,
      "message": "this is kept as std::function because SmallFunction doesn\u0027t work?",
      "range": {
        "startLine": 88,
        "startChar": 37,
        "endLine": 88,
        "endChar": 45
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e52ac12f_050c24ab",
        "filename": "libs/binder/include/binder/RpcTransport.h",
        "patchSetId": 8
      },
      "lineNbr": 88,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-10-18T16:37:39Z",
      "side": 1,
      "message": "I thought I explained this somewhere, but now I can\u0027t find where it was. I was about to ask you what do you want to do about this.\n\nTo use SmallFunction here, I would need to move `SmallFunction` and `assert_small_callable` from internal Utils.h to public libbinder includes. If that\u0027s what you want, please let me know into which header file should I put these (or create new?).",
      "parentUuid": "162d6ffe_7696253c",
      "range": {
        "startLine": 88,
        "startChar": 37,
        "endLine": 88,
        "endChar": 45
      },
      "revId": "f3435c2dbdba6d342f7078af63bb9b42d4093f06",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}