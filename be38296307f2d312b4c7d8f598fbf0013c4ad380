{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ce9743d3_6d614ddd",
        "filename": "libs/binder/RpcTransportTls.cpp",
        "patchSetId": 3
      },
      "lineNbr": 548,
      "author": {
        "id": 1031048
      },
      "writtenOn": "2021-08-12T16:28:06Z",
      "side": 1,
      "message": "Right, this is what I was referring to in https://android-review.googlesource.com/c/platform/frameworks/native/+/1745081/42..44/libs/binder/RpcTransportTls.cpp#430, with the \"verify but ignore the result\" weird defaults.\n\nInstead, configure the handshake to fail on the certificates you don\u0027t like. This can matter if you ever do session resumption or client certificates (the handshake shouldn\u0027t send the Finished message). Plus it\u0027s just error-prone to have to check afterwards like this.\n\nIf you just want to use the built-in verifier (see note below), then call SSL_set_verify(ssl, SSL_VERIFY_PEER, nullptr). If you want to do something custom, you should specify a SSL_set_custom_verify callback.",
      "revId": "be38296307f2d312b4c7d8f598fbf0013c4ad380",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6ed51f6c_af13c62d",
        "filename": "libs/binder/RpcTransportTls.cpp",
        "patchSetId": 3
      },
      "lineNbr": 548,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-08-12T18:45:36Z",
      "side": 1,
      "message": "Done; I use SSL_CTX_set_verify. \n\nThe reason is that I don\u0027t know how to implement SSL_CTX_set_custom_verify to verify leaf certificate only. Could you please share an example?",
      "parentUuid": "ce9743d3_6d614ddd",
      "revId": "be38296307f2d312b4c7d8f598fbf0013c4ad380",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "98653b7e_5a35493a",
        "filename": "libs/binder/RpcTransportTls.cpp",
        "patchSetId": 3
      },
      "lineNbr": 563,
      "author": {
        "id": 1031048
      },
      "writtenOn": "2021-08-12T16:28:06Z",
      "side": 1,
      "message": "Is the aim to verify that the server sent you exactly `cert` as a leaf certificate, or is `cert` meant to be a CA certificate that issues things? This API is for configuring a CA certificate and does the whole path-building thing.",
      "revId": "be38296307f2d312b4c7d8f598fbf0013c4ad380",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "245c22fa_6fceb63a",
        "filename": "libs/binder/RpcTransportTls.cpp",
        "patchSetId": 3
      },
      "lineNbr": 563,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-08-12T18:45:36Z",
      "side": 1,
      "message": "For now, I only need `cert` to be the exact leaf certificate.\n\nI may want to configure CA certificate and do the path-building thing in the future, but Chad suggested in an email thread that I should be using conscrypt instead of libssl directly.\n\nWhich API should I use to only treat cert as the leaf certificate?",
      "parentUuid": "98653b7e_5a35493a",
      "revId": "be38296307f2d312b4c7d8f598fbf0013c4ad380",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}