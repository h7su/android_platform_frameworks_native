{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3029be42_3e84b984",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2023-03-27T22:26:17Z",
      "side": 1,
      "message": "@smoreland@google.com are there any tests that are killing RPC servers randomly or something similar?\n\nWould it be worth submitting this to see if we ever do hit any issues with extra packets from previous sessions?",
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a4fbea6b_27eaf339",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 337,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-03-27T23:46:59Z",
      "side": 1,
      "message": "create a new RPC server instead?",
      "range": {
        "startLine": 337,
        "startChar": 0,
        "endLine": 337,
        "endChar": 23
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1322888c_918361db",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 337,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-03-29T16:18:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a4fbea6b_27eaf339",
      "range": {
        "startLine": 337,
        "startChar": 0,
        "endLine": 337,
        "endChar": 23
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "88fca354_dacea5da",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2023-03-27T22:26:17Z",
      "side": 1,
      "message": "as far as I know, this is only needed for INET. Can this be moved to setupInetServer instead?",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aa6dfbf2_88206712",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-03-27T23:46:59Z",
      "side": 1,
      "message": "This is also dangerous in general, and it can result in flakes or garbage data being passed. Can we use a different address or otherwise wait until it\u0027s shutdown?",
      "parentUuid": "88fca354_dacea5da",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "06d82b34_f77dbc8e",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2023-03-27T23:54:03Z",
      "side": 1,
      "message": "\u003e Can we use a different address\n\nNot if it\u0027s a static IP like the original idea.\n\n\u003e otherwise wait until it\u0027s shutdown\n\nIt\u0027s a full minute wait time until the address can be used. So that would really limit the use cases for inet binder RPC.",
      "parentUuid": "aa6dfbf2_88206712",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58384e6d_d58aa413",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-03-27T23:57:49Z",
      "side": 1,
      "message": "I mean a different port.\n\nAnyway - I\u0027m okay with SO_REUSEADDR if it\u0027s an option (not the default)",
      "parentUuid": "06d82b34_f77dbc8e",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "47bc9f07_95aeaa4e",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2023-03-28T00:01:25Z",
      "side": 1,
      "message": "The port is also static in the initial automotive design. The client wouldn\u0027t know where to reach the service.\n\n+1 to being an option",
      "parentUuid": "58384e6d_d58aa413",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "95f6904e_0b6049ca",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2023-03-28T17:41:14Z",
      "side": 1,
      "message": "Are there other options that we expect to need in the future? https://pubs.opengroup.org/onlinepubs/000095399/functions/setsockopt.html\nWe probably don\u0027t want to keep adding new paremeters to the setup.*Server methods, but it setsockopt needs the option name and a value. \nSo we\u0027d need to either have an argument to says I want this specific thing, or take a list of name/value pairs to pass to setsockopt to be flexible.",
      "parentUuid": "47bc9f07_95aeaa4e",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e28ae7f7_a134b14e",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2023-03-28T19:14:18Z",
      "side": 1,
      "message": "Add an independent API, which will store additional socket options, and then that value can be read to setup the server when setupInetServer is called.\n\nAs an alternative, we can not implement this and request setupRawSocketServer be used instead, since it supports this functionality.",
      "parentUuid": "95f6904e_0b6049ca",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "95d4a63e_c2a7b5b0",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-03-28T19:32:23Z",
      "side": 1,
      "message": "Do you mean similar to gAutoThreadPool?\nhttp://cs/android/system/software_defined_vehicle/platform/rpc/libsdvrpc/libsdvrpc.cpp;l\u003d137;rcl\u003dcae06b9fcc4f9de4d9c0a6328de5a8c9f61441a4\n\nOther options:\n- SO_REUSEPORT\n- How about SO_LINGER (to partially address the concern of garbage data)?\n\nIf doing this through gAutoThreadPool-style per-process config, I would bundle all 3 together as \"restart friendly\" option.",
      "parentUuid": "95f6904e_0b6049ca",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1d1f9361_b90b555d",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-03-28T20:54:58Z",
      "side": 1,
      "message": "Also, I don\u0027t think I can move this to `setupInetServer`: SO_REUSEPORT/ADDR needs to be set between `socket` and `bind`.",
      "parentUuid": "95d4a63e_c2a7b5b0",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b0159d7_be30471d",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2023-03-28T21:38:23Z",
      "side": 1,
      "message": "I guess a per-process config would work since we would likely never mix the static config and non static config.\nBut I wast thinking @smoreland@google.com meant another API on RpcServer that could be called before setting up the connection.\nThis would still require the new info to be passed at the \"addService\" level still.\n\n`SO_REUSEPORT` looks like it is allowing multiple threads to listen in on the same port and accept different connections. Right now we have a single thread that is accepting new connections on that port and I haven\u0027t seen any desire to change that. I don\u0027t think we would want to allow DIFFERENT servers to listen on the same port.\n\n`SO_LINGER` only changes the behavior of `close()` or `shutdown()`. I think the more common issue would be the server crashing and restarting without any call to `close()` or `shutdown()`.",
      "parentUuid": "1d1f9361_b90b555d",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19f4f512_edd84533",
        "filename": "libs/binder/RpcServer.cpp",
        "patchSetId": 3
      },
      "lineNbr": 562,
      "author": {
        "id": 1135107
      },
      "writtenOn": "2023-03-29T16:18:27Z",
      "side": 1,
      "message": "Config: done (I just noticed RpcServer creation and setup is separate). But the \"NDK\" variant puts these two together, so I set true as a default for these APIs - is this okay? Otherwise, I would have to add per-process config for NDK flavor. I left a few TODOs until we clarify this.\n\n`SO_REUSEPORT` doesn\u0027t seem to be related to multi-threading, per https://stackoverflow.com/q/14388706 - from what I read here, if `SO_REUSEPORT` is available on the system it\u0027s the option you\u0027d likely want to use.\n\n`SO_LINGER` sounds like you\u0027re right - linger option is not applicable for crashes and this is the case we really want to cover.",
      "parentUuid": "6b0159d7_be30471d",
      "range": {
        "startLine": 562,
        "startChar": 53,
        "endLine": 562,
        "endChar": 65
      },
      "revId": "068288fe02b668a3cf9e4d46e1e7ffe9e0db353e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}