{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3109d2ca_19a11b0e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1887356
      },
      "writtenOn": "2022-02-24T08:24:41Z",
      "side": 1,
      "message": "use aosp dialer can also reproduce this issue in Android S",
      "revId": "98c7ea9aeeaef797fad36442b721158143cea334",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b373314b_ac9dcffa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1887356
      },
      "writtenOn": "2022-02-24T10:08:08Z",
      "side": 1,
      "message": "add issues ID: https://partnerissuetracker.corp.google.com/issues/221177658\n\nthe issue still happen in Android 12 OS + Android 12 aosp dialer, pixel also have this issue, more detail log and video you check in https://partnerissuetracker.corp.google.com/issues/221177658\n\nThanks",
      "revId": "98c7ea9aeeaef797fad36442b721158143cea334",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e6c9bef9_49322e56",
        "filename": "libs/input/InputTransport.cpp",
        "patchSetId": 6
      },
      "lineNbr": 1003,
      "author": {
        "id": 1149384
      },
      "writtenOn": "2022-04-19T18:09:47Z",
      "side": 1,
      "message": "We can\u0027t do this, because it will break the following behaviour promise [0](https://developer.android.com/reference/android/view/MotionEvent#getHistorySize()) :\n\n```\ngetHistorySize\nAdded in API level 1\n\npublic int getHistorySize ()\nReturns the number of historical points in this event. These are movements that have occurred between this event and the previous event. This only applies to ACTION_MOVE events -- all other actions will have a size of 0.\n```\n\nSo I think the solution should be to overwrite the coordinates instead, like this:\n\n```\nvoid InputConsumer::rewriteMessage(TouchState\u0026 state, InputMessage\u0026 msg) {\n    nsecs_t eventTime \u003d msg.body.motion.eventTime;\n    for (uint32_t i \u003d 0; i \u003c msg.body.motion.pointerCount; i++) {\n        uint32_t id \u003d msg.body.motion.pointers[i].properties.id;\n        if (state.lastResample.idBits.hasBit(id)) {\n            if (eventTime \u003c state.lastResample.eventTime ||\n                    state.recentCoordinatesAreIdentical(id) ||\n                    msg.body.motion.action \u003d\u003d AMOTION_EVENT_ACTION_UP) {\n                PointerCoords\u0026 msgCoords \u003d msg.body.motion.pointers[i].coords;\n                const PointerCoords\u0026 resampleCoords \u003d state.lastResample.getPointerById(id);\n```\n\n\nI will work on submitting that CL internally and will cherry-pick to aosp. I will update you.",
      "range": {
        "startLine": 1003,
        "startChar": 72,
        "endLine": 1003,
        "endChar": 95
      },
      "revId": "98c7ea9aeeaef797fad36442b721158143cea334",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fb55bcff_7652ec70",
        "filename": "libs/input/InputTransport.cpp",
        "patchSetId": 6
      },
      "lineNbr": 1003,
      "author": {
        "id": 1887356
      },
      "writtenOn": "2022-05-26T07:46:29Z",
      "side": 1,
      "message": "Dear Siarhei,\n\nThanks, but I still have some question:\n\n1. action down has also add in addHistory.\n    case AMOTION_EVENT_ACTION_DOWN: {\n        ssize_t index \u003d findTouchState(deviceId, source);\n        if (index \u003c 0) {\n            mTouchStates.push_back({});\n            index \u003d mTouchStates.size() - 1;\n        }\n        TouchState\u0026 touchState \u003d mTouchStates[index];\n        touchState.initialize(deviceId, source);\n        touchState.addHistory(msg);//addHistory\n        break;\n    }\n\n2. mTouchStates.erase\n    case AMOTION_EVENT_ACTION_UP:\n    case AMOTION_EVENT_ACTION_CANCEL: {\n        ssize_t index \u003d findTouchState(deviceId, source);\n        if (index \u003e\u003d 0) {\n            TouchState\u0026 touchState \u003d mTouchStates[index];\n            rewriteMessage(touchState, msg);\n            mTouchStates.erase(mTouchStates.begin() + index);//remove index\n        }\n        break;\n    }",
      "parentUuid": "e6c9bef9_49322e56",
      "range": {
        "startLine": 1003,
        "startChar": 72,
        "endLine": 1003,
        "endChar": 95
      },
      "revId": "98c7ea9aeeaef797fad36442b721158143cea334",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fbfc2efc_601c029f",
        "filename": "libs/input/InputTransport.cpp",
        "patchSetId": 6
      },
      "lineNbr": 1003,
      "author": {
        "id": 1149384
      },
      "writtenOn": "2022-05-26T15:22:58Z",
      "side": 1,
      "message": "1. The code you pointed to:\n\n  touchState.addHistory(msg);//addHistory\n  \nAdds a historical record to the touch state (mTouchStates), but not to the MotionEvent. So that code doesn\u0027t do what you think it does. The field TouchState.history is used to calculate the resampled coordinates. It doesn\u0027t (directly) affect the MotionEvent.\n\n2. Can you explain this in a bit more detail? What exactly are you asking about here?",
      "parentUuid": "fb55bcff_7652ec70",
      "range": {
        "startLine": 1003,
        "startChar": 72,
        "endLine": 1003,
        "endChar": 95
      },
      "revId": "98c7ea9aeeaef797fad36442b721158143cea334",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "83d623bc_ca5ec1a2",
        "filename": "libs/input/InputTransport.cpp",
        "patchSetId": 6
      },
      "lineNbr": 1003,
      "author": {
        "id": 1887356
      },
      "writtenOn": "2022-06-13T01:17:53Z",
      "side": 1,
      "message": "Dear Siarhei,\n\nThanks, I will abandon this change, please upload your solution.",
      "parentUuid": "fbfc2efc_601c029f",
      "range": {
        "startLine": 1003,
        "startChar": 72,
        "endLine": 1003,
        "endChar": 95
      },
      "revId": "98c7ea9aeeaef797fad36442b721158143cea334",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}