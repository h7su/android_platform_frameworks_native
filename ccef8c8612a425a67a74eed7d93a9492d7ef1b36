{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "aee9465e_ed0944a9",
        "filename": "services/sensorservice/aidl/EventQueue.cpp",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2022-11-11T19:19:20Z",
      "side": 1,
      "message": "Question for @bduddie@google.com. Is this ok to have here in the dtor instead of onLastStrongRef?",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 69,
        "endChar": 57
      },
      "revId": "ccef8c8612a425a67a74eed7d93a9492d7ef1b36",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10a9e633_5dca60de",
        "filename": "services/sensorservice/aidl/EventQueue.cpp",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1074038
      },
      "writtenOn": "2022-11-17T21:02:34Z",
      "side": 1,
      "message": "Looking at the CL history, ag/2134094 says it\u0027s because a circular dep existed. It doesn\u0027t seem like that has been fixed with this CL. Can you confirm this reference loop doesn\u0027t exist?",
      "parentUuid": "aee9465e_ed0944a9",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 69,
        "endChar": 57
      },
      "revId": "ccef8c8612a425a67a74eed7d93a9492d7ef1b36",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aed49a97_01445962",
        "filename": "services/sensorservice/aidl/EventQueue.cpp",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2022-11-17T21:52:34Z",
      "side": 1,
      "message": "There shouldn\u0027t be a circular dep w/ fds, but the recommendation would be to use std::weak_ptr one of the directions.",
      "parentUuid": "10a9e633_5dca60de",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 69,
        "endChar": 57
      },
      "revId": "ccef8c8612a425a67a74eed7d93a9492d7ef1b36",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04401848_4a44bad5",
        "filename": "services/sensorservice/aidl/EventQueue.cpp",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2022-11-17T23:54:06Z",
      "side": 1,
      "message": "The `wp\u003c::android::SensorEventQueue\u003e mQueue;` here in `EventQueueLooperCallback` should break the cycle.\n\nI don\u0027t see a good way to add a test for this. I tried using `SensorManagerAidl` with the `libnativetesthelper_jni` but it crashes in `javaVm-\u003eAttachCurrentThread` when trying to create the EventQueue.\n\nI think we can verify/address this later when I\u0027m changing some clients to use the new AIDL interface.",
      "parentUuid": "aed49a97_01445962",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 69,
        "endChar": 57
      },
      "revId": "ccef8c8612a425a67a74eed7d93a9492d7ef1b36",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "61c11636_ca19cd2c",
        "filename": "services/sensorservice/aidl/EventQueue.cpp",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1074038
      },
      "writtenOn": "2022-11-18T16:00:59Z",
      "side": 1,
      "message": "Ack, as long as we intend to come back to it. I would suggest we retain the old logic unless it\u0027s no longer compatible in this new world and evaluate changing to the destructor when you\u0027ve migrated clients over and can validate it works, but I won\u0027t hold you to that if you have reasons that require changing this now.",
      "parentUuid": "04401848_4a44bad5",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 69,
        "endChar": 57
      },
      "revId": "ccef8c8612a425a67a74eed7d93a9492d7ef1b36",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3bb69322_0533d610",
        "filename": "services/sensorservice/aidl/EventQueue.cpp",
        "patchSetId": 2
      },
      "lineNbr": 69,
      "author": {
        "id": 1644679
      },
      "writtenOn": "2022-11-18T19:23:17Z",
      "side": 1,
      "message": "There is no onLastStrongRef to override here with AIDL which is why I put it in the dtor. So any future fix(if required) will have to come from managing the strong pointers differently. b/259711508",
      "parentUuid": "61c11636_ca19cd2c",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 69,
        "endChar": 57
      },
      "revId": "ccef8c8612a425a67a74eed7d93a9492d7ef1b36",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}