{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1092bfbd_f8323b29",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2023-11-06T09:35:25Z",
      "side": 1,
      "message": "This is a rewrite of aosp/1957445. Instead of introducing a new sysprop for the apex, we can rely on \"sphal\" namespace to load drivers.",
      "revId": "eddbd9f616793b09816a0dcced4e8f0d6aa3f2d3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3098f0cd_0e4bcf2a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2023-11-06T16:52:44Z",
      "side": 1,
      "message": "Hey Peiyong,\n\nThis change is to allow EGL/GLES drivers to be loaded from \"sphal\" namespace as well as from the fixed location (e.g. /vendor/lib/egl). This means that graphics libraries can be loaded from a vendor apex if the apex is a part of \"sphal\" namespace. In the topic, a new graphics APEX with graphic drivers is created for demonstration.\n\nPlease take a look.",
      "revId": "eddbd9f616793b09816a0dcced4e8f0d6aa3f2d3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eae2baf5_6a4624e8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1267775
      },
      "writtenOn": "2023-11-06T17:22:18Z",
      "side": 1,
      "message": "There are a couple things that we are moving towards: 1) We are trying to reduce the paths where the graphics driver exists and hence reduce the time to search them; 2) We are trying to move to use ANGLE as the default GLES and by that time the GLES driver will only have one path `/system/${LIB}`; 3) the library name must be fixed, e.g. it must be `libxxx_${ro.hardware.egl}.so`",
      "revId": "eddbd9f616793b09816a0dcced4e8f0d6aa3f2d3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b7a50aa8_96f018ae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2023-11-06T17:41:52Z",
      "side": 1,
      "message": "Thanks Peiyong,\n\n1) and 2) I don\u0027t think this conflicts with that direction. Newly added one is invoked if it\u0027s not ANGLE. So, if ANGLE is the default GLES, then this is just no-op.\n\n3) This change doesn\u0027t change about naming. The libraries are still `libxxx_${ro.hardware.egl}.so`.",
      "parentUuid": "eae2baf5_6a4624e8",
      "revId": "eddbd9f616793b09816a0dcced4e8f0d6aa3f2d3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8c870b45_89625d3e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1267775
      },
      "writtenOn": "2023-11-06T17:43:41Z",
      "side": 1,
      "message": "It is a conflict, because every path we add here must be maintained backward compatible for as long as GRF requires us, which is currently 4 years.",
      "parentUuid": "b7a50aa8_96f018ae",
      "revId": "eddbd9f616793b09816a0dcced4e8f0d6aa3f2d3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "02223c45_99000995",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2023-11-06T17:51:00Z",
      "side": 1,
      "message": "Right. But in fact, this isn\u0027t adding a new path, but rather removing the path restriction.\n\nFor now, the loader loads drivers from /vendor/lib/egl via `android_load_sphal_library`.\n\nIn this change, the loader loads drivers via `android_load_sphal_library`.",
      "parentUuid": "8c870b45_89625d3e",
      "revId": "eddbd9f616793b09816a0dcced4e8f0d6aa3f2d3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1605d86b_18a206b9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1267775
      },
      "writtenOn": "2023-11-06T17:57:40Z",
      "side": 1,
      "message": "I am confused. By making this modification you added more paths other than `/vendor/${LIB}/egl`, right?",
      "parentUuid": "02223c45_99000995",
      "revId": "eddbd9f616793b09816a0dcced4e8f0d6aa3f2d3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "34c3e4bb_890c2bb4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1415877
      },
      "writtenOn": "2023-11-06T18:11:08Z",
      "side": 1,
      "message": "Yes. But paths are hidden in linker configuration. Especially, since we use `android_load_sphal_library`, Loader can still load drivers from \u0027sphal\u0027 namespace without specifying actual path.\n\nFor now, \u0027sphal\u0027 namespace has /vendor/lib/egl in its search paths. But it can be extended via vendor apex.",
      "parentUuid": "1605d86b_18a206b9",
      "revId": "eddbd9f616793b09816a0dcced4e8f0d6aa3f2d3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}