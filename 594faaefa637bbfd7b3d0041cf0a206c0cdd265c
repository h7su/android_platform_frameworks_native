{
  "comments": [
    {
      "key": {
        "uuid": "484558ed_655e7b20",
        "filename": "services/sensorservice/SensorDevice.cpp",
        "patchSetId": 6
      },
      "lineNbr": 98,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2017-10-04T21:58:49Z",
      "side": 1,
      "message": "There is still a race condition here:\n\nimagine in lines 96 and 97, the hal dies and restarts, and you get the notification, then when reset is called, it clears mRestartObserved.\n\nNow line 102 will fail, so you\u0027ll set mSensors again and then wait for another restart, however, the sensors hal has already restarted, so you\u0027ll wait forever.\n\n\nIn order to fix this the right way, you need to hold the mRestartWaiter lock during part of this function as well, I believe.",
      "range": {
        "startLine": 98,
        "startChar": 7,
        "endLine": 98,
        "endChar": 32
      },
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44326e77_1b86ce7a",
        "filename": "services/sensorservice/SensorDevice.cpp",
        "patchSetId": 6
      },
      "lineNbr": 98,
      "author": {
        "id": 1074523
      },
      "writtenOn": "2017-10-04T22:52:28Z",
      "side": 1,
      "message": "There will be always a race condition between getService() and reset(). The hal service can crash right before getService() returns. The wait on line 110 will timeout in 1 sec and will not wait forever.\n\nThe only right place to wait is inside getService(). This should be all fixed after resolution of b/67425500.",
      "parentUuid": "484558ed_655e7b20",
      "range": {
        "startLine": 98,
        "startChar": 7,
        "endLine": 98,
        "endChar": 32
      },
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "13ba0937_2db00e76",
        "filename": "services/sensorservice/SensorDevice.cpp",
        "patchSetId": 6
      },
      "lineNbr": 98,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2017-10-04T23:24:22Z",
      "side": 1,
      "message": "getService already does the wait (waiting for the service before the 1 second sleep is ever called).\n\ngetService basically looks like this:\n\nservice \u003d get from hwservicemanager\nreturn if ok\nwaitForService\nservice \u003d get from hwservicemanager\nreturn if ok\nrepeat {\n    sleep 1\n    waitForService\n    service \u003d get from hwservicemanager\n    return if ok\n}\n\nSince the manifests are updated, I highly recommend going with the simplest solution (rather than re-implementing some of the complicated logic in getService).",
      "parentUuid": "44326e77_1b86ce7a",
      "range": {
        "startLine": 98,
        "startChar": 7,
        "endLine": 98,
        "endChar": 32
      },
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dcc8b956_f406a498",
        "filename": "services/sensorservice/SensorDevice.h",
        "patchSetId": 6
      },
      "lineNbr": 43,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2017-10-04T21:58:49Z",
      "side": 1,
      "message": "missed this before, this will dump all of these into the android namespace. I recommend putting these inside of SensorDevice.",
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ce57ea71_fdbb6068",
        "filename": "services/sensorservice/SensorDevice.h",
        "patchSetId": 6
      },
      "lineNbr": 43,
      "author": {
        "id": 1074523
      },
      "writtenOn": "2017-10-04T22:52:28Z",
      "side": 1,
      "message": "Done by moving it back to cpp file and use full name in header.",
      "parentUuid": "dcc8b956_f406a498",
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2ebfab1_33cb42d6",
        "filename": "services/sensorservice/SensorDevice.h",
        "patchSetId": 6
      },
      "lineNbr": 179,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2017-10-04T21:58:49Z",
      "side": 1,
      "message": "I thought this was remove once sensor hals get rid of the polling interface? Also, always TODO with a bug. Otherwise these things get forgotten about.",
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b1978873_8ed8da31",
        "filename": "services/sensorservice/SensorDevice.h",
        "patchSetId": 6
      },
      "lineNbr": 179,
      "author": {
        "id": 1074523
      },
      "writtenOn": "2017-10-04T22:52:28Z",
      "side": 1,
      "message": "Removing the troublesome poll() is also something to be done. But it will be for next interface version.\n\nAdded bug number as advised.",
      "parentUuid": "c2ebfab1_33cb42d6",
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cdd36e6d_830f3d28",
        "filename": "services/sensorservice/SensorDeviceUtils.cpp",
        "patchSetId": 6
      },
      "lineNbr": 32,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2017-10-04T21:58:49Z",
      "side": 1,
      "message": "nit: just \"default\"",
      "range": {
        "startLine": 32,
        "startChar": 57,
        "endLine": 32,
        "endChar": 79
      },
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a3540694_375ec8ba",
        "filename": "services/sensorservice/SensorDeviceUtils.cpp",
        "patchSetId": 6
      },
      "lineNbr": 32,
      "author": {
        "id": 1074523
      },
      "writtenOn": "2017-10-04T22:52:28Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "cdd36e6d_830f3d28",
      "range": {
        "startLine": 32,
        "startChar": 57,
        "endLine": 32,
        "endChar": 79
      },
      "revId": "594faaefa637bbfd7b3d0041cf0a206c0cdd265c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}