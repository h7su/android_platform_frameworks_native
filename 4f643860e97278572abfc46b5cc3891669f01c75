{
  "comments": [
    {
      "key": {
        "uuid": "M5Bnb-Bw",
        "filename": "libs/binder/ProcessState.cpp",
        "patchSetId": 1
      },
      "lineNbr": 313,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2012-12-11T18:21:19Z",
      "side": 1,
      "message": "the ioctl to get the binder version _reads_ the version passed in? that sounds more like either (a) valgrind is confused or (b) there\u0027s a bug in the ioctl implementation?",
      "revId": "4f643860e97278572abfc46b5cc3891669f01c75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "M4psH-M8",
        "filename": "libs/binder/ProcessState.cpp",
        "patchSetId": 1
      },
      "lineNbr": 313,
      "author": {
        "id": 1010988
      },
      "writtenOn": "2012-12-12T08:06:51Z",
      "side": 1,
      "message": "Yes. valgrind may be confused about some system calls and ioctl is just a case in point. Normally, you need to add a wrapper in valgrind itself for specific kind of operation so that valgrind could recognize it.\n\nHere it seems that it is not only just read, macro BINDER_VERSION uses _IOWR, like this:\n\n#define BINDER_VERSION\t_IOWR(\u0027b\u0027, 9, struct binder_version)",
      "parentUuid": "M5Bnb-Bw",
      "revId": "4f643860e97278572abfc46b5cc3891669f01c75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "M75AH5c8",
        "filename": "libs/binder/ProcessState.cpp",
        "patchSetId": 1
      },
      "lineNbr": 313,
      "author": {
        "id": 1000866
      },
      "writtenOn": "2012-12-13T18:23:42Z",
      "side": 1,
      "message": "Yeah that should be _IOW only.  Add Arve for comments.\n\nIs Valgrind smart enough to track the specific ioctl declaration and generate a warning based on that?  If so--WOW.",
      "parentUuid": "M4psH-M8",
      "revId": "4f643860e97278572abfc46b5cc3891669f01c75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "M1PL8Z2k",
        "filename": "libs/binder/ProcessState.cpp",
        "patchSetId": 1
      },
      "lineNbr": 313,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2012-12-13T18:29:33Z",
      "side": 1,
      "message": "You can\u0027t change it to _IOW, because that would change the ioctl number and break the api.  The ioctl number is just a number to the kernel.  The _IOWR macros provide a convenient convention to store a direction flag that most modern ioctls use, but binder does not.  The direction bits in binder ioctls are not reliable, so you\u0027ll need a manual definition in valgrind somehow.",
      "parentUuid": "M75AH5c8",
      "revId": "4f643860e97278572abfc46b5cc3891669f01c75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}