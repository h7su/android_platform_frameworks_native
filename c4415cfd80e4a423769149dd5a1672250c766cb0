{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3e212cfb_bb19fe7b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-08-25T02:48:49Z",
      "side": 1,
      "message": "LGTM. I\u0027m not able to give a +2 in China due to a known bug. Please ask someone else for a +2. Sorry for the inconvenience.",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "51942424_8e3ba7b8",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 81,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-08-26T13:25:45Z",
      "side": 1,
      "message": "nit: one more space",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8f36b911_d627a8e7",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 81,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-08-27T01:51:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "51942424_8e3ba7b8",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6b2615f_ca6a1067",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1642,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-08-26T13:25:45Z",
      "side": 1,
      "message": "What if we get a block request at this point?",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cf79d970_b72823ff",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1642,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-08-27T01:51:44Z",
      "side": 1,
      "message": "It will fork and kill. There are not that much things before fork, so I want to avoid checking it too frequently but I will add one more check before fork.",
      "parentUuid": "f6b2615f_ca6a1067",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cedd837b_599081a3",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1642,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-08-27T03:20:18Z",
      "side": 1,
      "message": "I\u0027m not sure that \"it will fork and kill\", even if an additional check is added. Consider the following case:\n\nT0: Check is_dexopt_blocked(), get `false`.\nT0: Fork.\nT1: Call control_dexopt_blocking(true)\nT1: Kill processes in dexopt_pids_ (Note that the newly forked process is not in the set yet)\nT0: Add the child pid to dexopt_pids_.\n\nI think a mutex needs to be used to avoid this reace condition.",
      "parentUuid": "cf79d970_b72823ff",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4292ea6e_8330fd49",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1642,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-08-27T17:48:47Z",
      "side": 1,
      "message": "Yes, you are right. fork and adding should be done under mutex as atomic operation. I will update it.",
      "parentUuid": "cedd837b_599081a3",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e64170d6_d8b48e2d",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1715,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-08-26T13:25:45Z",
      "side": 1,
      "message": "Can cancelled be true and WTERMSIG(result) not be SIGKILL?",
      "range": {
        "startLine": 1715,
        "startChar": 45,
        "endLine": 1715,
        "endChar": 55
      },
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fdf9bb0d_fe203eb2",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1715,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-08-27T01:51:44Z",
      "side": 1,
      "message": "Yes if it has crashed for other reason while running / cancelled. In that case, it will be better to report error.",
      "parentUuid": "e64170d6_d8b48e2d",
      "range": {
        "startLine": 1715,
        "startChar": 45,
        "endLine": 1715,
        "endChar": 55
      },
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3351c30a_3d9750df",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1787,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-08-26T13:25:45Z",
      "side": 1,
      "message": "Same question: what if we get a cancel request here?",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6797e8bd_4679e610",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1787,
      "author": {
        "id": 1010465
      },
      "writtenOn": "2021-08-27T01:51:44Z",
      "side": 1,
      "message": "it should be caught in later steps. if there are steps taking long time, better to add additional check as necessary.",
      "parentUuid": "3351c30a_3d9750df",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ebd6ec82_c9e0b7b5",
        "filename": "cmds/installd/dexopt.cpp",
        "patchSetId": 9
      },
      "lineNbr": 1787,
      "author": {
        "id": 1884045
      },
      "writtenOn": "2021-08-27T03:20:18Z",
      "side": 1,
      "message": "Ditto.",
      "parentUuid": "6797e8bd_4679e610",
      "revId": "c4415cfd80e4a423769149dd5a1672250c766cb0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}