{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "bdab8b45_72f722cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1958315
      },
      "writtenOn": "2022-11-03T12:52:45Z",
      "side": 1,
      "message": "Hi all,\n\nI have adjusted this API to take an init-managed Unix domain name as param instead of the raw pathname. This allows us to create the unix socket in init and associate it to RPC binder in the API. Could you take another look?",
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6510bf51_84115ae1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1958315
      },
      "writtenOn": "2022-11-03T15:54:42Z",
      "side": 1,
      "message": "Hi Steven, \n\nPTAL. The added API is used in https://r.android.com/2267603",
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "afbb7dcd_bf97541f",
        "filename": "libs/binder/libbinder_rpc_unstable.cpp",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-11-03T17:20:44Z",
      "side": 1,
      "message": "I think you should just pass in the fd to this function. In the general case we shouldn\u0027t care here where the socket comes from.",
      "range": {
        "startLine": 96,
        "startChar": 3,
        "endLine": 96,
        "endChar": 57
      },
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e475f4bf_8257c438",
        "filename": "libs/binder/libbinder_rpc_unstable.cpp",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1958315
      },
      "writtenOn": "2022-11-04T09:45:01Z",
      "side": 1,
      "message": "This method is only called in the rust librpcbinder_rs. Currently the cutils_rust_bindgen is not in the cutils[1]. Would you like me to first move the bindgen to cutils and then convert the socket_name to fd in rust/rpcbinder/src/server.rs? We can also do this after this cl, wdyt?\n\n[1] https://cs.android.com/android/platform/superproject/+/master:system/security/prng_seeder/Android.bp;l\u003d21;drc\u003d021cf557e6cdf1ff0779e87834532c0e0e893ef8",
      "parentUuid": "afbb7dcd_bf97541f",
      "range": {
        "startLine": 96,
        "startChar": 3,
        "endLine": 96,
        "endChar": 57
      },
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1492f94_df011b50",
        "filename": "libs/binder/libbinder_rpc_unstable.cpp",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-11-04T10:22:21Z",
      "side": 1,
      "message": "Yeah we should move the bindgen to cutils at some point.\n\nI\u0027m just not convinced that the Rust API even in server.rs should be dealing with these socket names at all; it seems like a cleaner interface if it is passed the socket fd. Getting the fd from init seems like a separate concern.",
      "parentUuid": "e475f4bf_8257c438",
      "range": {
        "startLine": 96,
        "startChar": 3,
        "endLine": 96,
        "endChar": 57
      },
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10940694_33db8ccf",
        "filename": "libs/binder/libbinder_rpc_unstable.cpp",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1958315
      },
      "writtenOn": "2022-11-04T10:27:27Z",
      "side": 1,
      "message": "Then all the clients of the API will need to take cutils and convert the name to fd, that\u0027s not a bit repetitive?\n\nMy initial thought was to have a similar API as what we have today for service_manager. From one end, we can register the service with a name, and from the other end, we just get the service with the same name. How the name is converted to other thing shouldn\u0027t be a concern for the clients.",
      "parentUuid": "c1492f94_df011b50",
      "range": {
        "startLine": 96,
        "startChar": 3,
        "endLine": 96,
        "endChar": 57
      },
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f53e421d_f7e4cf44",
        "filename": "libs/binder/libbinder_rpc_unstable.cpp",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1060831
      },
      "writtenOn": "2022-11-04T10:53:54Z",
      "side": 1,
      "message": "Hmm, that\u0027s also a fair point.\nLet\u0027s see what David \u0026 Steven think.",
      "parentUuid": "10940694_33db8ccf",
      "range": {
        "startLine": 96,
        "startChar": 3,
        "endLine": 96,
        "endChar": 57
      },
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58831786_acdd5c62",
        "filename": "libs/binder/libbinder_rpc_unstable.cpp",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2022-11-04T21:41:05Z",
      "side": 1,
      "message": "There are rust/libc APIs to open sockets (or - we can setup the named sockets from init rc and already have the FD open). This libcutils API is a thin wrapper over the core APIs. No need to use/work with this exact code, is there? We could avoid libcutils entirely",
      "parentUuid": "f53e421d_f7e4cf44",
      "range": {
        "startLine": 96,
        "startChar": 3,
        "endLine": 96,
        "endChar": 57
      },
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2c42644_7fcf3ea9",
        "filename": "libs/binder/libbinder_rpc_unstable.cpp",
        "patchSetId": 9
      },
      "lineNbr": 96,
      "author": {
        "id": 1958315
      },
      "writtenOn": "2022-11-04T22:13:49Z",
      "side": 1,
      "message": "Indeed, the named socket is set up in init.rc[1] with this cl. libcutils_socket is used here to retrieve the open fd with the given socket name. The name-\u003efd conversion is inside librpcbinder_rs because I\u0027d like to provide an API similar to service_manager: register_service(service, name)/get_service(name).\n\nThe second approach is to let clients do this name-\u003efd conversion with libcutils_socket. So that our API will be register_service(service, fd)/get_service(name). In this case, librpcbinder_rs doesn\u0027t need libcutils_socket anymore.\n\nWhich API would you like us to continue?\n\nAnd you mean we can just implement our own `android_get_control_socket()` instead of taking it from libcutils?\n\n[1] https://r.android.com/c/platform/packages/modules/Virtualization/+/2267603/9/microdroid_manager/microdroid_manager.rc",
      "parentUuid": "58831786_acdd5c62",
      "range": {
        "startLine": 96,
        "startChar": 3,
        "endLine": 96,
        "endChar": 57
      },
      "revId": "7d8a5fbb31f45859719435d331e2d66c0b4c33a8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}